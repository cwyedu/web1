<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎵 猜歌小挑戰</title>
    
    <!-- 內嵌 CSS 樣式 -->
    <style>
        /* 重置默認樣式並設定基本字體 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* 主遊戲容器 */
        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
        }

        /* 遊戲標題樣式 */
        .game-title {
            font-size: 2.5rem;
            color: #333;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* 音樂播放器容器 */
        .audio-container {
            margin-bottom: 30px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

        /* HTML5 音頻播放器樣式 */
        audio {
            width: 100%;
            height: 40px;
            margin-bottom: 15px;
        }

        /* 播放控制按鈕 */
        .play-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .control-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        /* 輸入框樣式 */
        .input-container {
            margin-bottom: 25px;
        }

        .guess-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.2rem;
            text-align: center;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .guess-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.2);
        }

        /* 按鈕容器 */
        .button-container {
            margin-bottom: 25px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }

        /* 主要按鈕樣式 */
        .btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* 不同功能按鈕的顏色 */
        .btn-submit {
            background: #28a745;
        }

        .btn-submit:hover {
            background: #218838;
        }

        .btn-answer {
            background: #ffc107;
            color: #212529;
        }

        .btn-answer:hover {
            background: #e0a800;
        }

        .btn-next {
            background: #17a2b8;
        }

        .btn-next:hover {
            background: #138496;
        }

        .btn-restart {
            background: #6f42c1;
        }

        .btn-restart:hover {
            background: #5a359a;
        }

        /* 反饋訊息區域 */
        .feedback {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 成功訊息樣式 */
        .feedback.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        /* 錯誤訊息樣式 */
        .feedback.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        /* 資訊訊息樣式 */
        .feedback.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        /* 遊戲完成訊息樣式 */
        .feedback.complete {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeaa7;
        }

        /* 隱藏元素 */
        .hidden {
            display: none !important;
        }

        /* 響應式設計 - 手機版 */
        @media (max-width: 600px) {
            .game-container {
                padding: 20px;
                margin: 10px;
            }

            .game-title {
                font-size: 2rem;
            }

            .button-container {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                max-width: 200px;
                margin-bottom: 10px;
            }

            .control-btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
        }

        /* 載入動畫 */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- 主遊戲容器 -->
    <div class="game-container">
        <!-- 遊戲標題 -->
        <h1 class="game-title">🎵 猜歌小挑戰</h1>
        
        <!-- 音樂播放器區域 -->
        <div class="audio-container">
            <!-- HTML5 音頻標籤，支援多種格式 -->
            <audio id="audioPlayer" controls preload="metadata">
                <!-- 提示用戶瀏覽器不支援音頻播放 -->
                您的瀏覽器不支援音頻播放功能。
            </audio>
            
            <!-- 播放控制按鈕 -->
            <div class="play-controls">
                <button id="playBtn" class="control-btn">▶️ 播放</button>
                <button id="pauseBtn" class="control-btn">⏸️ 暫停</button>
            </div>
        </div>

        <!-- 使用者輸入區域 -->
        <div class="input-container">
            <input type="text" 
                   id="guessInput" 
                   class="guess-input" 
                   placeholder="請輸入歌名..." 
                   maxlength="50">
        </div>

        <!-- 遊戲控制按鈕 -->
        <div class="button-container">
            <button id="submitBtn" class="btn btn-submit">送出答案</button>
            <button id="showAnswerBtn" class="btn btn-answer">看答案</button>
            <button id="nextSongBtn" class="btn btn-next hidden">再來一首</button>
            <button id="restartBtn" class="btn btn-restart hidden">重新開始</button>
        </div>

        <!-- 反饋訊息區域 -->
        <div id="feedback" class="feedback">
            🎵 準備好了嗎？按下播放鍵開始猜歌！
        </div>
    </div>

    <!-- JavaScript 遊戲邏輯 -->
    <script>
        /**
         * 🎵 猜歌小挑戰 - 遊戲核心邏輯
         * 
         * 這個 JavaScript 程式碼包含了完整的遊戲邏輯，
         * 包括歌曲管理、使用者互動、遊戲狀態控制等功能。
         */

        // ==================== 遊戲資料定義 ====================
        
        /**
         * 歌曲資料陣列
         * 注意：這裡使用的是佔位符路徑，實際使用時需要替換為真實的 MP3 檔案路徑
         * 例如：將 './songs/song1.mp3' 替換為實際的音檔 URL 或本地檔案路徑
         */
const songDatabase = [
    { 
        title: 'Golden', 
        artist: 'Harry Styles', 
        src: './songs/golden.mp3'
    },
    { 
        title: '好好先生', 
        artist: '未知',  // 不確定歌手，可再補
        src: './songs/好好先生.mp3'
    },
    { 
        title: '缺口', 
        artist: '未知',  // 不確定歌手，可再補
        src: './songs/缺口.mp3'
    },
    { 
        title: '等你下課', 
        artist: '周杰倫', 
        src: './songs/等你下課.mp3'
    },
    { 
        title: '蝸牛', 
        artist: '周杰倫', 
        src: './songs/蝸牛.mp3'
    }
];
        // ==================== 遊戲狀態變數 ====================
        
        let currentSong = null;           // 當前播放的歌曲物件
        let availableSongs = [];          // 可用歌曲陣列（避免重複）
        let gameCompleted = false;        // 遊戲是否完成標誌
        let currentRound = 0;             // 當前回合數
        let hasGuessed = false;           // 是否已經猜過此首歌

        // ==================== DOM 元素獲取 ====================
        
        /**
         * 獲取 HTML 頁面中的各個互動元素
         * 這些元素將在遊戲過程中被程式動態控制
         */
        const audioPlayer = document.getElementById('audioPlayer');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const guessInput = document.getElementById('guessInput');
        const submitBtn = document.getElementById('submitBtn');
        const showAnswerBtn = document.getElementById('showAnswerBtn');
        const nextSongBtn = document.getElementById('nextSongBtn');
        const restartBtn = document.getElementById('restartBtn');
        const feedback = document.getElementById('feedback');

        // ==================== 遊戲初始化 ====================
        
        /**
         * 初始化遊戲
         * 重置所有遊戲狀態，準備開始新遊戲
         */
        function initializeGame() {
            console.log('🎮 初始化遊戲...');
            
            // 重置遊戲狀態變數
            availableSongs = [...songDatabase]; // 複製歌曲資料庫，避免修改原始資料
            gameCompleted = false;
            currentRound = 0;
            hasGuessed = false;
            currentSong = null;
            
            // 重置 UI 元素
            guessInput.value = '';
            feedback.textContent = '🎵 準備好了嗎？選一首歌開始猜歌！';
            feedback.className = 'feedback';
            
            // 重置按鈕狀態
            submitBtn.classList.remove('hidden');
            showAnswerBtn.classList.remove('hidden');
            nextSongBtn.classList.add('hidden');
            restartBtn.classList.add('hidden');
            
            // 暫停並重置音頻播放器
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
            
            // 開始第一首歌
            loadNextSong();
        }

        // ==================== 歌曲管理功能 ====================
        
        /**
         * 載入下一首歌曲
         * 從可用歌曲中隨機選擇一首，並設定到音頻播放器
         */
        function loadNextSong() {
            console.log('🎵 載入下一首歌...');
            
            // 檢查是否還有可用歌曲
            if (availableSongs.length === 0) {
                endGame();
                return;
            }
            
            // 隨機選擇一首歌曲
            const randomIndex = Math.floor(Math.random() * availableSongs.length);
            currentSong = availableSongs[randomIndex];
            
            // 從可用歌曲中移除已選擇的歌曲（避免重複）
            availableSongs.splice(randomIndex, 1);
            
            // 設定音頻播放器的來源
            audioPlayer.src = currentSong.src;
            
            // 重置回合狀態
            hasGuessed = false;
            currentRound++;
            
            // 更新 UI
            guessInput.value = '';
            feedback.textContent = `🎵 第 ${currentRound} 首歌載入完成！按播放鍵開始猜歌～`;
            feedback.className = 'feedback info';
            
            // 重置按鈕狀態
            submitBtn.classList.remove('hidden');
            showAnswerBtn.classList.remove('hidden');
            nextSongBtn.classList.add('hidden');
            
            console.log(`📀 載入歌曲：${currentSong.title} - ${currentSong.artist}`);
            
            // 嘗試自動播放（某些瀏覽器可能會阻擋自動播放）
            setTimeout(() => {
                playAudio();
            }, 500);
        }

        // ==================== 音頻控制功能 ====================
        
        /**
         * 播放音頻
         * 處理自動播放的瀏覽器限制
         */
        function playAudio() {
            const playPromise = audioPlayer.play();
            
            if (playPromise !== undefined) {
                playPromise
                    .then(() => {
                        console.log('🎵 音頻開始播放');
                    })
                    .catch(error => {
                        console.log('⚠️ 自動播放被瀏覽器阻擋，請手動點擊播放按鈕');
                        feedback.textContent = '⚠️ 請手動點擊播放按鈕開始播放音樂';
                        feedback.className = 'feedback info';
                    });
            }
        }

        /**
         * 暫停音頻播放
         */
        function pauseAudio() {
            audioPlayer.pause();
            console.log('⏸️ 音頻已暫停');
        }

        // ==================== 答案比對邏輯 ====================
        
        /**
         * 檢查使用者答案是否正確
         * 進行模糊比對，去除空白和標點符號
         * @param {string} userAnswer - 使用者輸入的答案
         * @param {string} correctTitle - 正確的歌曲標題
         * @returns {boolean} - 是否答對
         */
        function checkAnswer(userAnswer, correctTitle) {
            // 標準化答案：轉小寫、去除空白和標點符號
            const normalizeText = (text) => {
                return text
                    .toLowerCase()
                    .replace(/\s+/g, '')           // 去除所有空白
                    .replace(/[^\w\u4e00-\u9fa5]/g, ''); // 去除標點符號，保留中英文和數字
            };
            
            const normalizedUserAnswer = normalizeText(userAnswer);
            const normalizedCorrectTitle = normalizeText(correctTitle);
            
            console.log(`🔍 比對答案：用戶輸入"${normalizedUserAnswer}" vs 正確答案"${normalizedCorrectTitle}"`);
            
            // 完全匹配
            if (normalizedUserAnswer === normalizedCorrectTitle) {
                return true;
            }
            
            // 包含匹配（用戶答案包含正確標題的主要部分）
            if (normalizedCorrectTitle.includes(normalizedUserAnswer) && normalizedUserAnswer.length >= 2) {
                return true;
            }
            
            return false;
        }

        // ==================== 遊戲核心邏輯 ====================
        
        /**
         * 處理使用者提交答案
         */
        function submitAnswer() {
            const userAnswer = guessInput.value.trim();
            
            // 檢查輸入是否為空
            if (!userAnswer) {
                feedback.textContent = '❌ 請輸入歌名再送出答案！';
                feedback.className = 'feedback error';
                return;
            }
            
            // 檢查是否有當前歌曲
            if (!currentSong) {
                feedback.textContent = '❌ 請先載入歌曲！';
                feedback.className = 'feedback error';
                return;
            }
            
            console.log(`📝 使用者提交答案：${userAnswer}`);
            
            // 比對答案
            const isCorrect = checkAnswer(userAnswer, currentSong.title);
            
            if (isCorrect) {
                // 答對了！
                feedback.textContent = `✅ 猜對了！這首歌是「${currentSong.title}」- ${currentSong.artist}`;
                feedback.className = 'feedback success';
                hasGuessed = true;
                showNextOptions();
            } else {
                // 答錯了
                feedback.textContent = '❌ 猜錯了，再試一次！或點擊「看答案」查看正確答案';
                feedback.className = 'feedback error';
            }
            
            // 清空輸入框
            guessInput.value = '';
        }

        /**
         * 顯示正確答案
         */
        function showAnswer() {
            if (!currentSong) {
                feedback.textContent = '❌ 請先載入歌曲！';
                feedback.className = 'feedback error';
                return;
            }
            
            feedback.textContent = `💡 正確答案是：「${currentSong.title}」- ${currentSong.artist}`;
            feedback.className = 'feedback info';
            hasGuessed = true;
            showNextOptions();
        }

        /**
         * 顯示下一步選項（再來一首或重新開始）
         */
        function showNextOptions() {
            // 隱藏猜題按鈕
            submitBtn.classList.add('hidden');
            showAnswerBtn.classList.add('hidden');
            
            // 檢查是否還有更多歌曲
            if (availableSongs.length > 0) {
                nextSongBtn.classList.remove('hidden');
            } else {
                // 所有歌曲都猜完了
                setTimeout(endGame, 1500);
            }
            
            // 顯示重新開始按鈕
            restartBtn.classList.remove('hidden');
        }

        /**
         * 結束遊戲
         */
        function endGame() {
            gameCompleted = true;
            feedback.textContent = '🎉 恭喜！所有歌曲都完成了！你真是個音樂達人！';
            feedback.className = 'feedback complete';
            
            // 隱藏所有其他按鈕，只顯示重新開始
            submitBtn.classList.add('hidden');
            showAnswerBtn.classList.add('hidden');
            nextSongBtn.classList.add('hidden');
            restartBtn.classList.remove('hidden');
            
            // 停止音頻播放
            audioPlayer.pause();
            
            console.log('🎊 遊戲結束！');
        }

        // ==================== 事件監聽器 ====================
        
        /**
         * 設定所有按鈕和輸入框的事件監聽器
         */
        
        // 播放按鈕
        playBtn.addEventListener('click', () => {
            console.log('🎵 用戶點擊播放按鈕');
            playAudio();
        });
        
        // 暫停按鈕
        pauseBtn.addEventListener('click', () => {
            console.log('⏸️ 用戶點擊暫停按鈕');
            pauseAudio();
        });
        
        // 送出答案按鈕
        submitBtn.addEventListener('click', submitAnswer);
        
        // 看答案按鈕
        showAnswerBtn.addEventListener('click', showAnswer);
        
        // 再來一首按鈕
        nextSongBtn.addEventListener('click', () => {
            console.log('⏭️ 用戶要求下一首歌');
            loadNextSong();
        });
        
        // 重新開始按鈕
        restartBtn.addEventListener('click', () => {
            console.log('🔄 用戶要求重新開始遊戲');
            initializeGame();
        });
        
        // 輸入框回車鍵提交
        guessInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                submitAnswer();
            }
        });
        
        // 輸入框焦點事件（清除錯誤訊息）
        guessInput.addEventListener('focus', () => {
            if (feedback.classList.contains('error')) {
                feedback.textContent = '🎵 專心聽歌，輸入你猜到的歌名吧！';
                feedback.className = 'feedback';
            }
        });

        // ==================== 音頻事件監聽 ====================
        
        /**
         * 監聽音頻播放器的各種事件
         */
        
        // 音頻載入完成
        audioPlayer.addEventListener('loadeddata', () => {
            console.log('📡 音頻檔案載入完成');
        });
        
        // 音頻載入錯誤
        audioPlayer.addEventListener('error', (e) => {
            console.error('❌ 音頻載入失敗：', e);
            feedback.textContent = '❌ 音樂檔案載入失敗，請檢查檔案路徑是否正確';
            feedback.className = 'feedback error';
        });
        
        // 音頻播放結束
        audioPlayer.addEventListener('ended', () => {
            console.log('🎵 音頻播放結束');
            if (!hasGuessed && !gameCompleted) {
                feedback.textContent = '🎵 歌曲播放結束，你猜到是什麼歌了嗎？';
                feedback.className = 'feedback info';
            }
        });

        // ==================== 頁面載入完成後初始化 ====================
        
        /**
         * 當頁面完全載入後，自動初始化遊戲
         */
        document.addEventListener('DOMContentLoaded', () => {
            console.log('📱 頁面載入完成，開始初始化遊戲...');
            initializeGame();
        });

        // ==================== 額外功能和優化 ====================
        
        /**
         * 防止用戶意外離開頁面時丟失遊戲進度（可選功能）
         */
        window.addEventListener('beforeunload', (event) => {
            if (!gameCompleted && currentRound > 1) {
                event.preventDefault();
                event.returnValue = '確定要離開嗎？你的遊戲進度將會丟失。';
            }
        });
        
        /**
         * 鍵盤快捷鍵支援（可選功能）
         */
        document.addEventListener('keydown', (event) => {
            // 空白鍵 = 播放/暫停
            if (event.code === 'Space' && event.target !== guessInput) {
                event.preventDefault();
                if (audioPlayer.paused) {
                    playAudio();
                } else {
                    pauseAudio();
                }
            }
            
            // Escape 鍵 = 清空輸入框
            if (event.key === 'Escape') {
                guessInput.value = '';
                guessInput.blur();
            }
        });

        // ==================== 調試和開發工具 ====================
        
        /**
         * 開發者模式：在控制台顯示當前歌曲（僅供調試使用）
         * 在瀏覽器控制台輸入 showCurrentSong() 可以查看當前歌曲
         */
        window.showCurrentSong = function() {
            if (currentSong) {
                console.log(`🎵 當前歌曲：${currentSong.title} - ${currentSong.artist}`);
                console.log(`📁 檔案路徑：${currentSong.src}`);
            } else {
                console.log('❌ 目前沒有載入任何歌曲');
            }
        };
        
        /**
         * 開發者模式：顯示遊戲狀態
         */
        window.showGameStatus = function() {
            console.log('🎮 遊戲狀態資訊：');
            console.log(`📊 當前回合：${currentRound}`);
            console.log(`🎵 剩餘歌曲：${availableSongs.length}`);
            console.log(`✅ 遊戲完成：${gameCompleted}`);
            console.log(`🤔 已猜過：${hasGuessed}`);
        };

        // ==================== 程式碼結束 ====================
        
        console.log('🎵 猜歌小挑戰遊戲載入完成！');
        console.log('💡 開發者提示：在控制台輸入 showCurrentSong() 可以查看當前歌曲');
        console.log('💡 開發者提示：在控制台輸入 showGameStatus() 可以查看遊戲狀態');
        
    </script>
</body>
</html>